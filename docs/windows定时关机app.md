---

### **PRD 最终版：Windows 轻量化定时关机软件（Rust 开发）**  

---

### **第一部分：目标与背景**  
#### 1.1 产品定位  
一款专为**普通家庭用户**设计的轻量化 Windows 定时关机工具，核心价值是通过极简操作与清晰的时间管理，解决用户因“忘记手动关机”导致的设备空转耗电问题。  

#### 1.2 目标用户  
- **核心用户**：普通家庭用户（年龄覆盖全年龄段，尤其偏向对电脑操作熟悉度较低的用户，如长辈、学生或日常仅需基础功能的用户）。  
- **场景特征**：用户在家庭环境中使用电脑（如日常办公、娱乐、学习），常因专注使用、临时离开或夜间休息等情况，忘记主动关闭电脑，导致设备长时间空转耗电。  

#### 1.3 核心痛点  
家庭用户在使用 Windows 系统时，现有定时关机方案存在以下不足：  
- **操作门槛高**：Windows 自带的“任务计划程序”需手动配置复杂参数（如触发时间、操作类型），对非技术用户不友好；  
- **功能冗余**：第三方工具普遍功能复杂（如支持网络唤醒、多设备联动等），家庭用户仅需“简单定时关机”这一核心能力；  
- **缺乏直观反馈**：部分工具设置后无实时倒计时提醒，用户无法快速感知设备将在何时关机，导致误操作风险。  

#### 1.4 差异化价值  
本产品通过以下设计解决上述痛点：  
- **界面极简**：仅保留“设置关机时间”这一核心操作入口，无冗余功能模块；  
- **操作轻量化**：支持“一键设置”（如输入“30分钟后关机”或选择“今晚10点关机”），无需学习复杂规则；  
- **实时提醒**：设置后界面持续显示倒计时，确保用户清晰掌握设备关机时间，避免误操作。  

---

### **第二部分：需求**  
#### 2.1 功能性需求  
基于家庭用户“简单、轻量化、解决忘记关机”的核心诉求，功能性需求聚焦以下 4 个子功能，均通过用户故事明确用户价值：  

| 子功能模块          | 用户故事描述                                                                                                                                                                                                 |  
|---------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|  
| 时间设置入口        | 作为一名普通家庭用户，我想要通过点击“单次关机”输入“30分钟”或选择“今晚20:00”，或通过“每日关机”选择“22:00”（完成动作），以便用最简单的方式指定关机时间，无需记忆复杂规则（实现价值）。                             |  
| 倒计时实时显示      | 作为一名普通家庭用户，我想要在设置关机时间后，界面持续显示“剩余XX小时XX分钟”（完成动作），以便随时查看设备将在多久后关机，避免因遗忘设置而误操作（实现价值）。                                                   |  
| 关机任务执行        | 作为一名普通家庭用户，我想要到达设定时间后，电脑自动执行关机操作（完成动作），以便无需手动操作，设备按时关闭避免空转耗电（实现价值）。                                                                         |  
| 任务取消/修改       | 作为一名普通家庭用户，我想要在关机倒计时未结束时，点击“取消”按钮或重新设置新时间（完成动作），以便灵活调整关机计划，避免设备意外关闭（实现价值）。                                                             |  


#### 2.2 非功能性需求  
为确保软件符合“轻量化、易用、稳定”的家庭用户需求，非功能性需求重点约束以下维度：  

**2.2.1 性能要求**  
- 启动时间：冷启动（首次打开）≤2 秒，热启动（已关闭后重新打开）≤1 秒（基于普通家庭电脑配置，如 Intel i3 8 代/AMD Ryzen 3 2000 系列及以上）。  
- 资源占用：运行时内存占用≤50MB，CPU 平均占用≤2%（空闲状态）/≤5%（倒计时计算状态）（通过 Rust 语言的内存安全特性优化实现）。  

**2.2.2 兼容性要求**  
- 操作系统：支持 Windows 10（1903 及以上）、Windows 11（所有版本）；暂不支持 Windows 8.1 及以下旧版本（降低兼容性开发成本，聚焦主流用户）。  
- 系统架构：支持 x64 和 x86（32 位）架构（覆盖绝大多数家庭电脑）。  
- 权限要求：仅需“标准用户”权限即可运行（避免要求管理员权限，降低用户操作门槛）。  

**2.2.3 可靠性要求**  
- 任务持久化：设置的定时任务（单次/每日）在软件重启、电脑重启后仍保留（通过本地文件存储实现，存储路径：`C:\Users\<用户名>\AppData\Local\<软件名>\tasks.json`）。  
- 异常处理：若倒计时过程中电脑因休眠/睡眠导致时间偏移，唤醒后自动重新计算剩余时间（基于系统时间同步机制）。  
- 关机可靠性：到达设定时间后，若关机操作被系统阻止（如运行关键进程），需弹出提示“因系统进程运行中，关机已取消”（避免强制关机导致数据丢失）。  

**2.2.4 安全性要求**  
- 无后台数据收集：软件不收集用户个人信息（如 IP、设备 ID）、操作日志（仅本地存储必要任务数据）。  
- 操作权限隔离：关机操作需由用户主动触发或确认（避免软件自动执行未授权的关机）。  
- 输入校验：时间输入支持“分钟数”（如“30”）或“具体时间”（如“22:00”）格式，输入非法字符（如字母、符号）时提示“请输入有效时间（如30分钟或22:00）”（防止因输入错误导致任务异常）。  

**2.2.5 易用性要求**  
- 界面交互：主界面仅保留“单次关机”“每日关机”两个按钮，输入框/时间选择器集中布局（避免用户视线跳跃）。  
- 提示友好性：倒计时剩余 10 分钟时，界面文字颜色变为橙色；剩余 1 分钟时变为红色（通过视觉提示强化提醒）。  
- 错误反馈：所有操作错误（如取消未开始的任务、修改已生效的任务）均提供明确的文字提示（如“当前任务未开始，可直接修改”），不使用技术术语。  

**2.2.6 安装包体积**  
- 安装包大小≤5MB（通过 Rust 的静态编译优化，移除冗余依赖，仅保留必要系统组件调用）。  

---

### **第三部分：用户界面与用户体验（UI/UX）设计目标**  
#### 3.1 界面设计核心原则  
- **极简主义**：主界面仅保留必要元素（时间设置入口、倒计时显示、操作按钮），无冗余功能模块或广告。  
- **操作路径最短**：从打开软件到完成定时设置，用户最多需点击 2 次（选择“单次/每日”→输入时间→确认）。  
- **视觉友好**：采用高对比度配色（如深灰背景+白色文字），关键信息（倒计时）用大字体突出显示，避免小字体或复杂图标干扰。  

#### 3.2 主界面关键元素设计  
主界面是用户完成所有操作的核心场景，需重点优化以下元素：  

| 元素名称          | 设计描述                                                                                                                                                                                                 | 设计目标                                                                                     |  
|-------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------|  
| 功能切换区        | 顶部水平排列“单次关机”和“每日关机”两个按钮（默认选中“单次关机”），按钮文字简洁无冗余（如不写“设置单次定时关机”，仅写“单次关机”）。                                                                       | 让用户 1 秒内明确“我要设置哪种类型的定时任务”，减少阅读成本。                                   |  
| 时间输入区        | 输入框左侧标注“关机时间：”，右侧提供两种输入方式：<br>- 文本输入（支持“30分钟”“1小时”“今晚22:00”“明天10:00”等自然语言格式）；<br>- 时间选择器（点击后弹出日历+时间选择弹窗，仅支持选择未来时间）。 | 兼顾不同用户的输入习惯（习惯打字的用户用文本输入，习惯点选的用户用时间选择器），降低输入错误率。 |  
| 倒计时显示区      | 主界面中央大字体显示“剩余XX小时XX分钟”（初始状态显示“未设置定时任务”），文字颜色默认绿色；剩余 10 分钟时变为橙色；剩余 1 分钟时变为红色。                                                                       | 实时反馈关机时间，通过颜色变化强化紧迫感，避免用户遗忘设置。                                 |  
| 操作按钮区        | 底部放置“开始/修改”和“取消”两个按钮（初始状态“开始”不可点击，输入时间后激活）。“取消”按钮仅在倒计时运行中显示（未设置时不显示）。                                                                       | 明确区分“确认设置”和“终止计划”的操作，避免误触。                                             |  

#### 3.3 交互流程优化  
用户从打开软件到完成任务的核心流程需控制在 3 步内：  
1. **打开软件**：主界面直接显示时间输入区和倒计时（首次打开时倒计时显示“未设置”）。  
2. **设置时间**：用户选择“单次/每日”→输入或选择时间→输入框下方实时校验（如输入“abc”时提示“请输入有效时间（如30分钟或22:00）”）。  
3. **确认执行**：输入有效时间后“开始”按钮变蓝→点击“开始”→倒计时显示区更新为“剩余XX小时XX分钟”→任务生效（后台运行）。  

#### 3.4 特殊场景体验设计  
- **首次使用引导**：首次打开软件时，界面顶部弹出浮层提示“点击‘单次关机’输入时间，或‘每日关机’设置重复任务”（3 秒后自动消失，避免干扰老用户）。  
- **后台运行提示**：软件最小化到托盘后，托盘图标显示剩余时间（如“2h30m后关机”）；鼠标悬停时弹出气泡提示详细信息（如“每日22:00关机任务进行中”）。  
- **错误处理反馈**：若用户尝试关闭正在运行的关机任务（如倒计时剩余 5 分钟时点击“取消”），弹出模态对话框提示“确定要取消当前关机任务吗？”（按钮为“取消”和“确认”，默认焦点在“取消”）。  

#### 3.5 设计验证标准  
- **新手用户测试**：邀请 3 名无技术背景的家庭用户（如长辈）完成“设置今晚 10 点关机”任务，平均操作时间≤1 分钟，错误次数≤1 次。  
- **视觉清晰度测试**：在距离屏幕 50cm 处，倒计时文字需清晰可辨（字体大小≥24pt）。  

---

### **第四部分：技术假设（Technical Assumptions）**  
以下假设为软件开发的基础条件，需在开发前验证或明确，若不满足可能导致功能无法实现或偏离目标。  

#### 4.1 系统API与权限依赖  
- **关机操作调用**：假设 Windows 系统允许通过 Rust 程序调用系统 API（如 `InitiateSystemShutdownEx`）或执行 `shutdown.exe /s /t <秒数>` 命令完成关机，且普通用户权限（非管理员）即可触发该操作（需验证不同 Windows 版本的实际权限限制）。  
- **托盘图标实现**：假设可通过 Rust 的 `winapi` 库或跨平台 GUI 库（如 `winit`+`tray-icon`）调用 Windows 的 `Shell_NotifyIcon` API 实现托盘图标功能（需验证最小化到托盘的稳定性）。  

#### 4.2 数据存储与持久化  
- **本地文件存储**：假设用户设置的定时任务（单次/每日）可通过 Rust 的 `serde` 库序列化为 JSON 格式，并存储于用户目录（如 `C:\Users\<用户名>\AppData\Local\<软件名>\tasks.json`），且该路径对标准用户具有读写权限（需验证不同 Windows 版本的 AppData 路径一致性）。  
- **系统时间同步**：假设当电脑因休眠/睡眠恢复后，系统时间会自动同步（如通过网络时间协议 NTP），软件可通过监听系统时间变更事件（如 `WM_TIMECHANGE` 消息）重新计算剩余时间（需验证事件监听的可靠性）。  

#### 4.3 多线程与异步处理  
- **计时逻辑实现**：假设 Rust 的标准库 `std::thread` 或异步运行时（如 `tokio`）可实现精确的倒计时计时（误差≤1 秒），且不会因主线程阻塞导致界面卡顿（需验证多线程与 GUI 线程的通信机制）。  

#### 4.4 输入解析与校验  
- **自然语言时间解析**：假设用户输入的“30分钟”“1小时”“今晚22:00”等格式可通过 Rust 的正则表达式库（如 `regex`）或自定义解析逻辑正确转换为时间间隔（秒数）或具体时间点（需验证边界情况，如“明天10:00”在跨天时的处理）。  

#### 4.5 兼容性与依赖管理  
- **Rust 目标平台**：假设 Rust 编译器（如 `rustc`）支持为 Windows x86_64 和 x86 架构生成可执行文件（需验证 `target` 参数配置的正确性）。  
- **系统依赖库**：假设软件仅依赖 Windows 系统自带组件（如 `kernel32.dll` 中的关机 API），无需额外安装运行时库（如 VC++ 运行时），以避免用户安装障碍（需验证链接的动态库是否为系统默认包含）。  

---

### **第五部分：功能模块列表（Epic List）**  
基于“轻量化定时关机软件”的核心定位和已确认的需求，功能模块划分为以下 6 个 Epic，覆盖从用户输入到任务执行的全流程：  

| Epic 编号 | Epic 名称               | 模块描述                                                                                     | 关联需求/用户故事                                                                 |  
|----------|------------------------|--------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|  
| EP01     | 时间设置模块           | 处理用户输入的单次/每日关机时间，支持自然语言解析（如“30分钟”“今晚22:00”）和格式校验。           | 功能性需求-时间设置入口；用户故事-“通过输入或选择时间设置关机”                     |  
| EP02     | 倒计时管理模块         | 实时计算剩余时间，驱动界面倒计时显示，并处理系统休眠/唤醒后的时间校准。                         | 功能性需求-倒计时实时显示；非功能性需求-可靠性（异常处理）                        |  
| EP03     | 关机任务执行模块       | 调用 Windows 系统 API 触发关机操作，处理关机失败场景（如系统进程阻止）并反馈提示。                   | 功能性需求-关机任务执行；非功能性需求-可靠性（关机可靠性）                          |  
| EP04     | 任务持久化模块         | 将用户设置的定时任务（单次/每日）存储至本地文件，并在软件重启或系统重启后恢复任务。             | 功能性需求-任务取消/修改；非功能性需求-可靠性（任务持久化）                        |  
| EP05     | 用户界面交互模块       | 实现主界面的渲染（时间输入区、倒计时显示、操作按钮）、托盘图标交互（最小化/恢复）及提示弹窗。    | 第三部分-UI/UX设计目标；功能性需求-任务取消/修改（取消按钮交互）                  |  
| EP06     | 系统兼容性适配模块     | 处理不同 Windows 版本（10/11）的 API 差异、权限校验（标准用户权限）及依赖库加载（如 `shutdown.exe`）。 | 技术假设-系统API与权限依赖；非功能性需求-兼容性（操作系统/架构支持）                |  

---

### **第六部分：功能模块详情（Epic Details）**  

#### **Epic 01：时间设置模块**  
**模块概述**：处理用户输入的单次/每日关机时间，支持自然语言解析（如“30分钟”“今晚22:00”）和格式校验，是用户与软件交互的起点。  

**用户故事**：  
- 作为一名普通家庭用户，我想要输入“30分钟”或选择“今晚22:00”来设置单次关机时间（完成动作），以便快速完成定时任务设置（实现价值）。  
- 作为一名普通家庭用户，我想要在“每日关机”模式下选择“22:00”并保存（完成动作），以便设备每天固定时间自动关闭（实现价值）。  

**验收标准**：  
- 支持的自然语言格式至少包含：“X分钟/小时”（如“30分钟”“2小时”）、“今晚XX:XX”“明天XX:XX”（如“今晚22:00”“明天10:00”）。  
- 输入非法字符（如“abc”“30分鐘”）时，界面实时提示“请输入有效时间（如30分钟或22:00）”。  
- 输入有效时间后，“开始”按钮变为可点击状态（蓝色高亮）。  
- 单次和每日模式切换时，输入框自动清空并重置为默认提示（如“请选择单次关机时间”）。  

**技术要点**：  
- 自然语言解析：需支持中文时间表达（如“今晚”对应当日20:00后，“明天”对应次日），通过正则表达式或自定义解析逻辑实现。  
- 时间校验：需校验输入时间是否为未来时间（如当前时间为21:00时，“20:00”需提示“时间不能早于当前时间”）。  
- 跨天处理：每日模式下输入“23:00”需正确存储为每日重复任务，单次模式下输入“明天10:00”需转换为具体日期时间戳。  

**依赖关系**：依赖系统时间获取（通过 Rust 的 `SystemTime` 接口），无外部系统依赖。  


#### **Epic 02：倒计时管理模块**  
**模块概述**：实时计算剩余时间，驱动界面倒计时显示，并处理系统休眠/唤醒后的时间校准，确保倒计时的准确性。  

**用户故事**：  
- 作为一名普通家庭用户，我设置“30分钟后关机”后，界面显示“剩余29分59秒”并每秒更新（完成动作），以便随时查看关机进度（实现价值）。  
- 作为一名普通家庭用户，电脑休眠2小时后唤醒，倒计时自动更新为“剩余28分59秒”（完成动作），以便无需重新设置任务（实现价值）。  

**验收标准**：  
- 倒计时显示精度≤1秒（界面每秒刷新一次）。  
- 系统休眠/睡眠恢复后，倒计时自动校准（误差≤5秒）。  
- 关机任务取消后，倒计时立即停止并清零。  
- 剩余时间≤10分钟时，界面文字颜色变为橙色；≤1分钟时变为红色（颜色变化明显可辨）。  

**技术要点**：  
- 计时算法：基于系统时间戳计算剩余时间（`目标时间戳 - 当前时间戳`），避免因线程阻塞导致计时偏差。  
- 系统事件监听：通过 Windows API（如 `RegisterWaitForSingleObject`）监听休眠/唤醒事件（`WM_POWERBROADCAST` 消息），触发时间重新计算。  
- 多线程同步：计时线程与界面线程需通过消息队列（如 Rust 的 `std::sync::mpsc`）通信，避免界面卡顿。  

**依赖关系**：依赖 Epic 01（时间设置模块）提供的目标时间戳，依赖系统时间服务。  


#### **Epic 03：关机任务执行模块**  
**模块概述**：调用 Windows 系统 API 触发关机操作，处理关机失败场景（如系统进程阻止）并反馈提示，是核心功能的最终执行环节。  

**用户故事**：  
- 作为一名普通家庭用户，设置“今晚22:00关机”后，电脑在22:00准时关闭（完成动作），以便设备按时断电（实现价值）。  
- 作为一名普通家庭用户，设置“30分钟后关机”后，若临时取消任务，电脑不会关机（完成动作），以便灵活调整计划（实现价值）。  

**验收标准**：  
- 到达设定时间后，关机操作成功率≥99%（测试100次仅允许1次失败）。  
- 关机失败时，界面弹出模态提示“因系统进程运行中，关机已取消”（按钮为“确定”）。  
- 取消任务时，倒计时立即停止，界面显示“任务已取消”。  
- 关机操作需由用户主动触发（如倒计时结束自动触发，或用户手动点击“开始”），无后台自动关机风险。  

**技术要点**：  
- 系统API调用：通过 Rust 调用 Windows 的 `shutdown.exe /s /t <秒数>` 命令（简单可靠）或 `InitiateSystemShutdownEx` API（更灵活）。  
- 权限处理：需验证普通用户是否有权限触发关机（Windows 标准用户默认有此权限，需测试不同版本）。  
- 失败检测：通过检查关机命令的返回码（如 `ERROR_SHUTDOWN_IN_PROGRESS`）判断是否失败。  

**依赖关系**：依赖 Epic 02（倒计时管理模块）提供的目标时间戳，依赖系统关机权限。  


#### **Epic 04：任务持久化模块**  
**模块概述**：将用户设置的定时任务（单次/每日）存储至本地文件，并在软件重启或系统重启后恢复任务，确保数据不丢失。  

**用户故事**：  
- 作为一名普通家庭用户，设置“每天22:00关机”后关闭软件，再次打开时任务仍存在（完成动作），以便无需重新设置（实现价值）。  
- 作为一名普通家庭用户，电脑重启后，软件自动恢复“今晚22:00关机”任务（完成动作），以便设备按时关闭（实现价值）。  

**验收标准**：  
- 任务存储成功率≥99%（测试100次存储仅允许1次丢失）。  
- 软件重启后，任务自动加载并显示倒计时（误差≤1分钟）。  
- 系统重启后，软件启动时自动读取存储的任务并恢复倒计时。  
- 手动删除存储文件后，软件提示“未找到历史任务”（不崩溃）。  

**技术要点**：  
- 文件存储路径：使用 `C:\Users\<用户名>\AppData\Local\<软件名>\tasks.json`（符合 Windows 用户数据存储规范）。  
- 序列化格式：采用 JSON 格式存储任务类型（单次/每日）、目标时间、是否启用等字段。  
- 冲突处理：避免多实例同时写入文件（通过文件锁或检查文件是否存在）。  

**依赖关系**：依赖 Epic 01（时间设置模块）提供的任务数据，依赖系统文件读写权限（标准用户可访问）。  


#### **Epic 05：用户界面交互模块**  
**模块概述**：实现主界面的渲染（时间输入区、倒计时显示、操作按钮）、托盘图标交互（最小化/恢复）及提示弹窗，是用户直接感知产品的核心界面。  

**用户故事**：  
- 作为一名普通家庭用户，打开软件后主界面清晰显示“单次关机”和“每日关机”按钮，输入时间后倒计时实时更新（完成动作），以便快速操作（实现价值）。  
- 作为一名普通家庭用户，最小化软件后，托盘图标显示“2h30m后关机”（完成动作），鼠标悬停时显示“每日22:00关机任务进行中”（完成动作），以便随时查看状态（实现价值）。  

**验收标准**：  
- 主界面加载时间≤1秒（冷启动）。  
- 输入时间后，倒计时显示区每秒更新一次（无卡顿）。  
- 托盘图标在软件最小化时显示，鼠标悬停提示信息准确（包含剩余时间和任务类型）。  
- 关键操作（如取消任务）弹出模态对话框，按钮焦点默认在“取消”（防止误触）。  

**技术要点**：  
- GUI 框架选择：采用轻量级 Rust GUI 库（如 `egui` 或 `Iced`），确保安装包体积≤5MB。  
- 托盘图标实现：通过 `winapi` 库调用 `Shell_NotifyIcon` API，支持任务栏通知区域图标显示。  
- 响应式布局：主界面元素（按钮、输入框）在不同屏幕分辨率（1024x768 及以上）下居中显示，无错位。  

**依赖关系**：依赖 Epic 02（倒计时管理模块）提供的剩余时间数据，依赖系统 GUI 组件支持。  


#### **Epic 06：系统兼容性适配模块**  
**模块概述**：处理不同 Windows 版本（10/11）的 API 差异、权限校验及依赖库加载，确保软件在主流系统上稳定运行。  

**用户故事**：  
- 作为一名普通家庭用户，使用 Windows 10（1903）打开软件，所有功能正常（完成动作），以便兼容旧版本系统（实现价值）。  
- 作为一名普通家庭用户，使用 Windows 11 打开软件，界面显示正常且无崩溃（完成动作），以便适配新版本系统（实现价值）。  

**验收标准**：  
- 支持 Windows 10（1903 及以上）、Windows 11（所有版本），其他版本提示“不支持当前系统”。  
- 标准用户权限下，所有功能（设置、关机、取消）均可正常使用（无需管理员权限）。  
- 软件启动时自动检测系统版本，不兼容时弹出提示“当前系统不支持，请升级至 Windows 10 1903 及以上”。  

**技术要点**：  
- 系统版本检测：通过 `GetVersionExW` API 获取 Windows 版本号，判断是否≥10.0.18362（1903）。  
- API 兼容性：对不同版本系统调用差异化的 API（如旧版本使用 `shutdown.exe`，新版本使用 `InitiateSystemShutdownEx`）。  
- 依赖库检查：确保仅调用系统自带 DLL（如 `kernel32.dll`），避免依赖第三方运行时库。  

**依赖关系**：依赖 Epic 03（关机任务执行模块）的系统 API 调用，依赖系统版本信息。  

---

### **结语**  
本 PRD 完整覆盖了产品从目标定位到开发落地的全链路需求，通过结构化的章节设计和可验证的验收标准，确保开发团队能高效理解并执行。若需调整具体细节（如补充功能、优化交互），可随时沟通，我将协助完善。